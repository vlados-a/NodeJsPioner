<% layout('layout/page') -%>
<% block('title', 'Chat')%>

<div id="room">
  <ul class="list">
  </ul>
  <form>
    <input type="text" class="form-control" placeholder="Your message..">
    <button type="submit" name="button" class="btn btn-primary">Post</button>
  </form>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
  (function($){
    var socket = io();
    var form = $('#room').find('form');
    function addMessage(text){
      $('<li>', {text: text}).appendTo($('#room').find('ul'));
    }
    form.submit(function(){
      var input  = form.find(":input");
      var text = input.val();
      input.val('');
      socket.emit('message', text, function(data){
        addMessage(data);        
      });
      return false;
    });
    socket.on('message', function (text) {
      addMessage(text);
    });
  })(jQuery);
</script>
